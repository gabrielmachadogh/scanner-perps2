name: Telegram Bot 24/7

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci || npm install

      - name: Keep Alive 24/7 with Socket
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          SOCKET_TOKEN: ${{ secrets.SOCKET_TOKEN }}
        run: |
          npm install telegraf socket.io-client
          node -e "
          const { Telegraf } = require('telegraf');
          const io = require('socket.io-client');
          const bot = new Telegraf(process.env.TELEGRAM_TOKEN);
          
          bot.start((ctx) => ctx.reply('Bot rodando 24/7 com GitHub Actions + Socket! üöÄ'));
          bot.launch();
          console.log('Bot iniciado!');

          const socket = io('https://socket.xf.bs', { 
            transports: ['websocket'],
            query: { token: process.env.SOCKET_TOKEN }
          });

          socket.on('connect', () => {
            console.log('Conectado ao socket - Bot 100% online 24/7');
          });

          setInterval(() => socket.emit('ping'), 250000); // mant√©m vivo
          "

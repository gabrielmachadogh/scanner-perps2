name: Telegram Bot 24/7

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci || npm install

      - name: Keep Alive 24/7 with Socket
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          npm install telegraf socket.io-client
          node -e "
          const { Telegraf } = require('telegraf');
          const io = require('socket.io-client');
          const bot = new Telegraf(process.env.TELEGRAM_BOT_TOKEN);
          
          bot.start((ctx) => ctx.reply('Bot rodando 24/7 com GitHub Actions + Socket! ðŸš€'));
          bot.launch();
          console.log('Bot iniciado! Chat ID configurado:', process.env.TELEGRAM_CHAT_ID);

          const socket = io('https://socket.xf.bs', { 
            transports: ['websocket'],
            query: { token: 'bot_' + process.env.TELEGRAM_BOT_TOKEN.slice(-10) }
          });

          socket.on('connect', () => {
            console.log('Conectado ao socket - Bot 100% online 24/7');
            bot.telegram.sendMessage(process.env.TELEGRAM_CHAT_ID, 'âœ… Bot online e rodando 24/7!').catch(() => {});
          });

          setInterval(() => socket.emit('ping'), 250000);
          "

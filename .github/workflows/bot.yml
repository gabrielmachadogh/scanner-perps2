name: Telegram Bot 24/7

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install python-telegram-bot python-socketio aiohttp

      - name: Run Bot 24/7
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          python -c "
          import asyncio
          import os
          from telegram import Bot
          from telegram.ext import Application, CommandHandler
          import socketio

          sio = socketio.AsyncClient()

          async def start(update, context):
              await update.message.reply_text('Bot rodando 24/7! ðŸš€')

          async def main():
              app = Application.builder().token(os.getenv('TELEGRAM_BOT_TOKEN')).build()
              app.add_handler(CommandHandler('start', start))
              
              await sio.connect('https://socket.xf.bs')
              print('âœ… Conectado ao socket - Bot online 24/7')
              
              bot = Bot(os.getenv('TELEGRAM_BOT_TOKEN'))
              await bot.send_message(chat_id=os.getenv('TELEGRAM_CHAT_ID'), text='âœ… Bot online!')
              
              async def keep_alive():
                  while True:
                      await sio.emit('ping')
                      await asyncio.sleep(250)
              
              asyncio.create_task(keep_alive())
              await app.run_polling()

          asyncio.run(main())
          "

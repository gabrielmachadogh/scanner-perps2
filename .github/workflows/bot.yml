name: Paper Trading Bot - 13h

on:
  schedule:
    - cron: '0 16 * * *'   # 13h hor√°rio de Bras√≠lia (UTC-3)
  workflow_dispatch:      # permite rodar manualmente

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt --no-cache-dir

      - name: Run Bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "üöÄ Bot iniciado √†s $(date '+%d/%m/%Y %H:%M') hor√°rio de Bras√≠lia"
          python telegram_paper_trading_bot.py
          echo "‚úÖ Bot finalizado com sucesso!"

      - name: Send success message to Telegram
        if: success()
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="‚úÖ *BOT RODADO COM SUCESSO!*%0AüìÖ $(date '+%d/%m/%Y')%0Aüïê $(date '+%H:%M') hor√°rio de Bras√≠lia%0Aüíö Tudo certo por aqui!" \
            -d parse_mode=Markdown

      - name: Send error message if failed
        if: failure()
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="‚ùå *ERRO AO RODAR O BOT*%0AüìÖ $(date '+%d/%m/%Y √†s %H:%M')%0Aüî¥ Verifique os logs no GitHub Actions" \
            -d parse_mode=Markdown
